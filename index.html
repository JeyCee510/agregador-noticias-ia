<script>
    // ... (Configuración de Supabase que ya funciona) ...

    async function cargarNoticias() {
        const { data, error } = await _supabase.from('noticias').select('*').order('creado_at', { ascending: false });
        if (error) return;

        const dashboard = document.getElementById('dashboard');
        dashboard.innerHTML = '';

        const grupos = {};
        data.forEach(n => {
            const medio = n.medio.replace(/https?:\/\/(www\.)?/, '').split('.')[0].toUpperCase();
            if (!grupos[medio]) grupos[medio] = [];
            grupos[medio].push(n);
        });

        Object.keys(grupos).forEach(medio => {
            const col = document.createElement('div');
            col.className = "min-w-[320px] max-w-[320px] flex-shrink-0 bg-slate-800/50 border border-slate-800 rounded-2xl p-4";
            
            let noticiasHTML = '';
            grupos[medio].forEach(n => {
                // Buscamos las etiquetas ignorando mayúsculas/minúsculas y asteriscos
                const r = n.resumen;
                const titulo = r.match(/TITULO:\s*(.*)/i)?.[1] || "Noticia en proceso";
                const breve = r.match(/BREVE:\s*(.*)/i)?.[1] || "Haz clic para ver el análisis completo.";
                
                noticiasHTML += `
                    <div onclick="abrirModal('${btoa(unescape(encodeURIComponent(n.resumen)))}')" class="mb-4 p-5 bg-slate-800 border border-slate-700 rounded-xl cursor-pointer hover:border-sky-500/50 transition-all group shadow-sm">
                        <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">${new Date(n.creado_at).toLocaleDateString()}</span>
                        <h3 class="font-bold text-slate-100 mt-2 group-hover:text-sky-400 transition-colors line-clamp-2">${titulo.replace(/\*/g, '')}</h3>
                        <p class="text-xs text-slate-400 mt-2 line-clamp-2">${breve.replace(/\*/g, '')}</p>
                    </div>
                `;
            });
            // ... (Resto del código de columnas)
